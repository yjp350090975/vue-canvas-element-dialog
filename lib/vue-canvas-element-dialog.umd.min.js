(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["vue-canvas-element-dialog"]=e():t["vue-canvas-element-dialog"]=e()})("undefined"!==typeof self?self:this,(function(){return function(){var t={838:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return l}});var n=function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"vue-canvas-element-dialog",staticStyle:{"font-size":"18px"},attrs:{visible:!0,title:"图片编辑",width:"1400px","close-on-click-modal":!1,"append-to-body":""},on:{close:t.closeDialog}},[e("div",{staticClass:"modal-body"},[e("div",{staticClass:"container",style:"height:"+t.dialogHeight+"px;",on:{"&scroll":function(e){return t.getScrollData(e)}}},[e("canvas",{ref:"canvas",attrs:{id:"canvas",width:t.canvasWidth,height:t.canvasHeight}}),e("textarea",{directives:[{name:"show",rawName:"v-show",value:t.isShowText,expression:"isShowText"}],staticClass:"text-style",attrs:{id:"textarea",name:"textBox",cols:"9",rows:"1",placeholder:"请输入"}})]),e("div",{staticClass:"tool-container"},[e("div",{staticClass:"icon-div icon",on:{click:function(e){t.isShowDrawPane=!t.isShowDrawPane}}},[e("i",{staticClass:"iconfont icon-tiaosepan"})]),e("div",{staticClass:"icon-div icon",on:{click:function(e){return t.filterObject("erase")}}},[e("i",{staticClass:"iconfont icon-rubber-full"})]),e("div",{staticClass:"icon-div icon",on:{click:function(e){return t.filterObject("undefined")}}},[e("i",{staticClass:"iconfont icon-quxian"})]),e("div",{staticClass:"icon-div icon",on:{click:function(e){return t.filterObject("line")}}},[e("i",{staticClass:"iconfont icon-xiantiao"})]),e("div",{staticClass:"icon-div icon",on:{click:function(e){return t.filterObject("arrows")}}},[e("i",{staticClass:"iconfont icon-jiantou_youshang_o"})]),e("div",{staticClass:"icon-div icon",on:{click:function(e){return t.filterObject("rect")}}},[e("i",{staticClass:"iconfont icon-24gl-rectangle"})]),e("div",{staticClass:"icon-div icon",on:{click:function(e){return t.filterObject("circle")}}},[e("i",{staticClass:"iconfont icon-xingzhuang-tuoyuanxing"})]),e("div",{staticClass:"icon-div icon",on:{click:function(e){return t.filterObject("text")}}},[e("i",{staticClass:"iconfont icon-wenben"})]),e("div",{staticClass:"icon-div icon",on:{click:function(e){return t.clearCanvas()}}},[e("i",{staticClass:"iconfont icon-shanchu"})]),e("div",{staticClass:"icon-div icon",on:{click:function(e){return t.redo()}}},[e("i",{staticClass:"iconfont icon-chehui",style:t.historyImageData.length>0?"":"color: #ddd;"})]),e("div",{staticClass:"icon-div icon",on:{click:function(e){return t.cancelRedo()}}},[e("i",{staticClass:"iconfont icon-zhongzuo",style:t.newHistoryImageData.length>0?"":"color: #ddd;"})]),e("div",{staticClass:"icon-div icon",on:{click:function(e){return t.downLoad()}}},[e("i",{staticClass:"el-icon-download"})]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowDrawPane,expression:"isShowDrawPane"}],staticClass:"drawPane"},[e("div",{on:{click:function(e){t.isShowDrawPane=!1}}},[e("el-icon",{staticClass:"el-icon-circle-close close-draw-pane",attrs:{scale:"3"}})],1),e("div",{staticClass:"colorClass"},[t._v("画笔大小")]),e("input",{attrs:{id:"lwRange",type:"range",min:"1",max:"10",value:"2"},on:{change:t.LwRangeBtn}}),e("div",{staticClass:"colorClass"},[t._v("画笔颜色")]),e("input",{attrs:{id:"lcolor",type:"color",value:"#ff0000"},on:{change:t.LcolorBtn}})])])]),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{plain:""},on:{click:t.closeDialog}},[t._v("取 消")]),e("el-button",{staticClass:"g-background00BCD4",attrs:{type:"primary",disable:t.loading,loading:t.loading},on:{click:t.submitBtn}},[t._v("保 存")])],1)])},a=[],o={name:"vue-canvas-element-dialog",props:{imgBase64:{type:String,default:""},dialogHeight:{type:Number,default:520}},data(){return{form:{},isShowDrawPane:!1,canvas:null,context:null,lwidth:2,lcolor:"#ff0000",textColor:"#ff0000",paintTypeArr:{painting:!1,erase:!1,line:!1,arrows:!1,rect:!1,circle:!1,text:!1},imageData:null,isShowText:!1,historyImageData:[],newHistoryImageData:[],socket:null,img:null,filterType:void 0,loading:!1,canvasWidth:940,canvasHeight:500,canvasScrollTop:0,canvasScrollLeft:0}},watch:{color(){this.context.strokeStyle=this.color}},mounted(){const t=this;t.init(),window.onresize=function(){t.init()},this.listen()},methods:{getScrollData(t){this.canvasScrollTop=t.target.scrollTop,this.canvasScrollLeft=t.target.scrollLeft},LwRangeBtn(){this.context.lineWidth=parseInt(document.getElementById("lwRange").value),this.lwidth=parseInt(document.getElementById("lwRange").value)},LcolorBtn(){this.context.fillStyle=document.getElementById("lcolor").value,this.context.strokeStyle=document.getElementById("lcolor").value,this.textColor=document.getElementById("lcolor").value},closeDialog(){this.$emit("onClose")},dataURLtoFile(t,e){const i=atob(t.split(",")[1]),n=[];for(let a=0;a<i.length;a++)n.push(i.charCodeAt(a));return new Blob([new Uint8Array(n)],{type:e})},init(){this.$nextTick((()=>{this.canvas=document.getElementById("canvas"),this.context=this.canvas.getContext("2d"),this.textColor="#ff0000",this.context.lineWidth="2",this.context.fillStyle="#ff0000",this.context.strokeStyle="#ff0000",this.imageData&&this.context.putImageData(this.imageData,0,0);const t=new Image;t.setAttribute("crossOrigin","anonymous");const e=this.imgBase64;t.src=e,t.onload=()=>{t.complete&&(this.canvas.setAttribute("width",t.width),this.canvas.setAttribute("height",t.height),this.context.drawImage(t,0,0,t.width,t.height),this.img=t,this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height))}}))},listen(){this.$nextTick((()=>{const t=this;let e={x:void 0,y:void 0};const i=t.canvas.getBoundingClientRect();var n=t.canvas.width/i.width,a=t.canvas.height/i.height;let o={x:void 0,y:void 0};t.canvas.onmousedown=function(s){t.paintTypeArr["painting"]=!0;let c=s.clientX,r=s.clientY;if(c-=i.left,r-=i.top,c+=t.canvasScrollLeft,r+=t.canvasScrollTop,e={x:c*n,y:r*a},t.paintTypeArr["text"]){const n=document.getElementById("textarea");if(t.isShowText){const e=n.value;t.isShowText=!1,n.value="",t.drawText(o.x,o.y,e)}else t.isShowText||(t.isShowText=!0,n.style.left=s.clientX-i.left+"px",n.style.top=s.clientY-i.top+160+"px",n.style.color=t.textColor,o={x:e.x,y:e.y})}if(t.paintTypeArr["erase"]){const i=t.context;i.save(),i.globalCompositeOperation="destination-out",i.beginPath();const n=t.lWidth/2>5?t.lWidth/2:5;i.arc(e.x,e.y,n,0,2*Math.PI),i.clip(),i.clearRect(0,0,t.canvas.width,t.canvas.height),i.restore()}var l=s||window.event;t.stopBubble(l)},t.canvas.onmousemove=function(o){let s=o.clientX,c=o.clientY;s-=i.left,c-=i.top,s+=t.canvasScrollLeft,c+=t.canvasScrollTop;const r={x:s*n,y:c*a};if(t.isPainting())t.drawLine(e.x,e.y,r.x,r.y),e=r;else if(t.paintTypeArr["erase"]){if(!e.x&&!e.y)return;t.handleErase(e.x,e.y,r.x,r.y),e=r}else t.paintTypeArr["line"]?(t.imageData&&t.context.putImageData(t.imageData,0,0),t.drawLine(e.x,e.y,r.x,r.y)):t.paintTypeArr["arrows"]?(t.imageData&&t.context.putImageData(t.imageData,0,0),t.drawArrow(e.x,e.y,r.x,r.y)):t.paintTypeArr["rect"]?(t.imageData&&t.context.putImageData(t.imageData,0,0),t.drawRect(e.x,e.y,r.x,r.y)):t.paintTypeArr["circle"]&&(t.imageData&&t.context.putImageData(t.imageData,0,0),t.drawCircle(e.x,e.y,r.x,r.y));var l=o||window.event;t.stopBubble(l)},t.canvas.onmouseup=function(){e={x:void 0,y:void 0},t.canvasDraw(),t.filterObject(t.filterType)}}))},filterObject(t){if(this.filterType=t,t)for(const e in this.paintTypeArr)this.paintTypeArr[e]=e===t;else for(const e in this.paintTypeArr)this.paintTypeArr[e]=!1},stopBubble(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},isPainting(){for(const t in this.paintTypeArr)if("painting"!==t&&this.paintTypeArr[t])return!1;return!!this.paintTypeArr["painting"]},handleErase(t,e,i,n){const a=this.context;var o=v*Math.sin(Math.atan((n-e)/(i-t))),s=v*Math.cos(Math.atan((n-e)/(i-t))),c=t+o,r=e-s,l=t-o,d=e+s,h=i+o,u=n-s,p=i-o,f=n+s;a.save(),a.beginPath(),a.globalCompositeOperation="destination-out";const v=this.lWidth/2>5?this.lWidth/2:5;a.arc(i,n,v,0,2*Math.PI),a.clip(),a.clearRect(0,0,this.canvas.width,this.canvas.height),a.restore(),a.save(),a.beginPath(),a.globalCompositeOperation="destination-out",a.moveTo(c,r),a.lineTo(h,u),a.lineTo(p,f),a.lineTo(l,d),a.closePath(),a.clip(),a.clearRect(0,0,this.canvas.width,this.canvas.height),a.restore()},drawLine(t,e,i,n){const a=this.context;a.beginPath(),a.lineCap="round",a.lineJoin="round",a.moveTo(t,e),a.lineTo(i,n),a.stroke(),a.closePath()},drawArrow(t,e,i,n){const a=this.context;var o,s,c=10,r=45,l=180*Math.atan2(e-n,t-i)/Math.PI,d=(l+r)*Math.PI/180,h=(l-r)*Math.PI/180,u=c*Math.cos(d),p=c*Math.sin(d),f=c*Math.cos(h),v=c*Math.sin(h);a.beginPath(),a.moveTo(t,e),a.lineTo(i,n),o=i+u,s=n+p,a.moveTo(o,s),a.lineTo(i,n),o=i+f,s=n+v,a.lineTo(o,s),a.stroke(),a.closePath()},drawRect(t,e,i,n){const a=this.context;a.strokeRect(t,e,Math.abs(i-t),Math.abs(n-e))},drawCircle(t,e,i,n){const a=this.context,o=Math.sqrt((t-i)*(t-i)+(e-n)*(e-n));a.beginPath(),a.arc(t,e,o,0,2*Math.PI,!0),a.stroke()},drawText(t,e,i){const n=this.context;n.save(),n.beginPath(),n.font="25px orbitron",n.textBaseline="top",n.fillText(i,parseInt(t),parseInt(e)),n.restore(),n.closePath()},clearCanvas(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.init()},canvasDraw(){this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.historyImageData.push(this.imageData)},redo(){const t=this.historyImageData,e=this.newHistoryImageData;if(t.length>0){const i=t.pop();e.push(i),0===t.length?(this.imageData=null,this.clearCanvas(),this.init()):this.context.putImageData(t[t.length-1],0,0)}},cancelRedo(){if(this.newHistoryImageData.length>0){const t=this.newHistoryImageData.pop();this.imageData=t,this.context.putImageData(t,0,0),this.historyImageData.push(t)}},downLoad(){const t=this.canvas.toDataURL("image/png"),e=document.createElement("a");e.href=t,e.download="绘图保存记录"+(new Date).getTime(),e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e)},submitBtn(){this.loading=!0,setTimeout((()=>{this.loading=!1}),3e3);const t={relativeType:3,name:"编辑图片"};console.log(t);const e=document.getElementById("canvas");var i=e.toDataURL("image/png");this.$emit("onSubmit",i)}}},s=o;function c(t,e,i,n,a,o,s,c){var r,l="function"===typeof t?t.options:t;if(e&&(l.render=e,l.staticRenderFns=i,l._compiled=!0),n&&(l.functional=!0),o&&(l._scopeId="data-v-"+o),s?(r=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),a&&a.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},l._ssrRegister=r):a&&(r=c?function(){a.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:a),r)if(l.functional){l._injectStyles=r;var d=l.render;l.render=function(t,e){return r.call(e),d(t,e)}}else{var h=l.beforeCreate;l.beforeCreate=h?[].concat(h,r):[r]}return{exports:t,options:l}}var r=c(s,n,a,!1,null,"3a5ed87c",null),l=r.exports},523:function(t,e,i){var n={"./index.vue":838};function a(t){var e=o(t);return i(e)}function o(t){if(!i.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}a.keys=function(){return Object.keys(n)},a.resolve=o,t.exports=a,a.id=523}},e={};function i(n){var a=e[n];if(void 0!==a)return a.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,i),o.exports}!function(){i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){i.p=""}();var n={};return function(){"use strict";if(i.r(n),i.d(n,{default:function(){return c}}),"undefined"!==typeof window){var t=window.document.currentScript,e=t&&t.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);e&&(i.p=e[1])}const a=i(523),o=t=>{o.installed||(o.installed,a.keys().forEach((e=>{const i=a(e),n=i.default.name;t.component(n,i.default||i)})))};"undefined"!==typeof window&&window.Vue&&o(window.Vue);var s={install:o},c=s}(),n}()}));
//# sourceMappingURL=vue-canvas-element-dialog.umd.min.js.map